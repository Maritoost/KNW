<!DOCTYPE html>
<html lang="nl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Kennisnetwerk Water</title>
<style>
    body { font-family: Arial, sans-serif; margin: 0; padding: 20px; background-color: #f4f4f4; }
    .bubble { width: 200px; height: 200px; border-radius: 50%; display: inline-flex; align-items: center; justify-content: center; color: white; font-size: 20px; font-weight: bold; cursor: pointer; margin: 10px; }
    #droogte { background-color: #ff6347; }
    #waterkwaliteit { background-color: #6ab150; }
    #wateroverlast { background-color: #4682b4; }
    .hidden { display: none; }
    footer { font-style: italic; font-size: 12px; text-align: center; margin-top: 20px; }
    .project { margin: 10px 0; }
    .details { display: none; margin-left: 20px; font-size: 1em; }
    .project-name { font-size: 1em; font-style: italic; cursor: pointer; color: black; text-decoration: underline; }
</style>
<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.17.0/xlsx.full.min.js"></script>
<script>
    let lastOpen = null;
    let lastVisible = null;

    function toggleDetails(projectId) {
        const details = document.getElementById(`details-${projectId}`);
        if (lastOpen && lastOpen !== details) {
            lastOpen.style.display = 'none';
        }
        details.style.display = details.style.display === 'none' ? 'block' : 'none';
        lastOpen = details.style.display === 'none' ? null : details;
    }

    function toggleVisibility(focusArea) {
        const element = document.getElementById(focusArea + "-projects");
        if (lastVisible && lastVisible !== element) {
            lastVisible.classList.add('hidden');
        }
        element.classList.toggle('hidden');
        lastVisible = element.classList.contains('hidden') ? null : element;
    }

    async function fetchExcel() {
        const url = 'https://raw.githubusercontent.com/Maritoost/KNW/main/Split_KennisNetwerk_Projects_version4.xlsx';
        const response = await fetch(url);
        if (!response.ok) {
            console.error('Failed to fetch the Excel file:', response.statusText);
            return;
        }
        const arrayBuffer = await response.arrayBuffer();
        const data = new Uint8Array(arrayBuffer);
        processExcel(data);
    }

    function processExcel(data) {
        const workbook = XLSX.read(data, { type: 'array' });
        const sheetName = workbook.SheetNames[0];
        const sheet = workbook.Sheets[sheetName];
        const json = XLSX.utils.sheet_to_json(sheet);

        const projectSections = {
            'Droogte': '',
            'Waterkwaliteit': '',
            'Wateroverlast': ''
        };

        json.forEach((row, index) => {
            const projectHtml = `
                <li class='project'><span class='project-name' onclick="toggleDetails('${index}-${row.Projectnaam.replace(/\s+/g, '-')}')">${row.Projectnaam}</span>
                    <div id="details-${index}-${row.Projectnaam.replace(/\s+/g, '-')}" class="details">
                        <p><strong>Hoofduitvoerder:</strong> ${row.Hoofduitvoerder}</p>
                        <p><strong>Samenvatting:</strong> ${row.Samenvatting}</p>
                        <p><strong>Bereik:</strong> ${row.Bereik}</p>
                        <p><strong>Financieringsbron:</strong> ${row.Financieringsbron}</p>
                        <p><strong>Organisatietype:</strong> ${row.Organisatietype}</p>
                        <p><strong>Samenwerkingspartners:</strong> ${row.Samenwerkingspartners}</p>
                        <p><strong>Gebruiker:</strong> ${row.Gebruiker}</p>
                        <p><strong>Website:</strong> <a href="${row.Website}" target="_blank">${row.Website}</a></p>
                    </div>
                </li>`;

            const focusAreas = row.Focusgebied.split(', ');
            focusAreas.forEach(focusArea => {
                if (projectSections[focusArea]) {
                    projectSections[focusArea] += projectHtml;
                }
            });
        });

        document.getElementById('droogte-projects').innerHTML = `<ul>${projectSections['Droogte']}</ul>`;
        document.getElementById('waterkwaliteit-projects').innerHTML = `<ul>${projectSections['Waterkwaliteit']}</ul>`;
        document.getElementById('wateroverlast-projects').innerHTML = `<ul>${projectSections['Wateroverlast']}</ul>`;
    }

    window.onload = fetchExcel;
</script>
</head>
<body>
<h1>Kennisnetwerk Water</h1>
<p style="font-size: 24px; font-weight: bold;">Focusgebieden:</p>
<div class="bubble" id="droogte" onclick="toggleVisibility('droogte')">Droogte</div>
<div class="bubble" id="waterkwaliteit" onclick="toggleVisibility('waterkwaliteit')">Waterkwaliteit</div>
<div class="bubble" id="wateroverlast" onclick="toggleVisibility('wateroverlast')">Wateroverlast</div>

<div id='droogte-projects' class='hidden'></div>
<div id='waterkwaliteit-projects' class='hidden'></div>
<div id='wateroverlast-projects' class='hidden'></div>

<footer>Het NSO voert de kennisnetwerkenregeling uit in samenwerking met de NWO, met financiering van het ministerie van OCW.</footer>
</body>
</html>
